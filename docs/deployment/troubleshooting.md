# 部署故障排除指南

## 概述

本文档记录了常见的部署问题和解决方案，帮助开发者快速解决部署过程中遇到的问题。

## 常见问题和解决方案

### 1. 缺少模块导入错误
**问题**: `name 'time' is not defined` 或类似的模块未导入错误
**解决方案**: 
- 检查所有必要的模块导入
- 确保在文件顶部添加所需的import语句

### 2. 缩进错误
**问题**: `IndentationError: unindent does not match any outer indentation level`
**解决方案**:
- 使用一致的缩进（推荐4个空格）
- 检查混合使用空格和制表符的情况
- 使用代码编辑器的格式化功能

## 部署流程

### GitHub部署流程
```bash
# 1. 提交代码修复
git add .
git commit -m "Fix: 描述修复内容"

# 2. 推送到远程仓库
git push origin main

# 3. 触发自动部署（如果配置了CI/CD）
```

### 手动部署到云平台
1. 将修复后的代码推送到GitHub
2. 在云平台控制台触发重新部署
3. 监控部署日志确保成功

## 部署验证

部署完成后，使用以下方法验证：

```bash
# 测试基础端点
curl https://your-api-domain.com/

# 测试健康检查
curl https://your-api-domain.com/health

# 运行API测试套件
python -m pytest tests/e2e/
```

## 预期结果

成功部署后应该看到：
- ✅ 基础端点返回200状态码
- ✅ 健康检查正常
- ✅ 所有API端点正常响应
- ✅ 测试套件通过

## 故障排除检查清单

1. **代码语法**: 确保没有语法错误
2. **依赖项**: 检查requirements.txt是否包含所有依赖
3. **环境变量**: 验证所有必要的环境变量已配置
4. **端口配置**: 确保应用监听正确的端口
5. **日志检查**: 查看应用启动日志排查问题

## 监控和日志

- 使用应用日志排查运行时问题
- 监控资源使用情况
- 设置健康检查和告警

## 回滚策略

如果部署失败：
1. 立即回滚到上一个稳定版本
2. 分析失败原因
3. 在本地环境修复问题
4. 重新测试后再次部署